function e(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=/*#__PURE__*/e(require("amqplib"));function t(e,n){try{var t=e()}catch(e){return n(e)}return t&&t.then?t.then(void 0,n):t}module.exports=/*#__PURE__*/function(){function e(e,n){this.connection=void 0,this.channel=void 0,this.connection=e,this.channel=n}e.create=function(t){try{return Promise.resolve(n.default.connect(t)).then(function(n){return Promise.resolve(n.createChannel()).then(function(t){return process.once("SIGINT",function(){try{return Promise.resolve(t.close()).then(function(){return Promise.resolve(n.close()).then(function(){})})}catch(e){return Promise.reject(e)}}),console.log("Connected to RabbitMQ"),new e(n,t)})})}catch(e){return Promise.reject(e)}};var r=e.prototype;return r.connect=function(e){try{var r=this,o=t(function(){return Promise.resolve(n.default.connect(e)).then(function(e){return r.connection=e,Promise.resolve(r.connection.createChannel()).then(function(e){r.channel=e,process.once("SIGINT",function(){try{return Promise.resolve(r.channel.close()).then(function(){return Promise.resolve(r.connection.close()).then(function(){})})}catch(e){return Promise.reject(e)}}),console.log("Connected to RabbitMQ")})})},function(e){console.warn(e)});return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},r.startListening=function(e,n){try{var r=this;if(!r.channel)return console.warn("RabbitMQ channel is not initialized."),Promise.resolve();var o=t(function(){return Promise.resolve(r.channel.assertQueue(e,{durable:!1})).then(function(){return Promise.resolve(r.channel.consume(e,function(e){try{var t=function(){if(e){var t=e.content.toString();console.log(t);var r=JSON.parse(t);return Promise.resolve(n(r)).then(function(){})}}();return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},{noAck:!0})).then(function(){console.log(" [*] Listening for messages in queue "+e)})})},function(e){console.warn(e)});return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},r.sendMessageToQueue=function(e,n){try{var r=this;if(!r.channel)return console.warn("RabbitMQ channel is not initialized."),Promise.resolve();var o=t(function(){return Promise.resolve(r.channel.assertQueue(e,{durable:!1})).then(function(){var t=JSON.stringify(n);r.channel.sendToQueue(e,Buffer.from(t)),console.log(" [x] Sent to queue "+e+": "+t)})},function(e){console.warn(e)});return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},e}();
