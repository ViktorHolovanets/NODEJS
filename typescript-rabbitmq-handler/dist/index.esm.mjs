import e from"amqplib";function n(e,n){try{var t=e()}catch(e){return n(e)}return t&&t.then?t.then(void 0,n):t}var t=/*#__PURE__*/function(){function t(e,n){this.connection=void 0,this.channel=void 0,this.connection=e,this.channel=n}t.create=function(n){try{return Promise.resolve(e.connect(n)).then(function(e){return Promise.resolve(e.createChannel()).then(function(n){return process.once("SIGINT",function(){try{return Promise.resolve(n.close()).then(function(){return Promise.resolve(e.close()).then(function(){})})}catch(e){return Promise.reject(e)}}),console.log("Connected to RabbitMQ"),new t(e,n)})})}catch(e){return Promise.reject(e)}};var r=t.prototype;return r.connect=function(t){try{var r=this,o=n(function(){return Promise.resolve(e.connect(t)).then(function(e){return r.connection=e,Promise.resolve(r.connection.createChannel()).then(function(e){r.channel=e,process.once("SIGINT",function(){try{return Promise.resolve(r.channel.close()).then(function(){return Promise.resolve(r.connection.close()).then(function(){})})}catch(e){return Promise.reject(e)}}),console.log("Connected to RabbitMQ")})})},function(e){console.warn(e)});return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},r.startListening=function(e,t){try{var r=this;if(!r.channel)return console.warn("RabbitMQ channel is not initialized."),Promise.resolve();var o=n(function(){return Promise.resolve(r.channel.assertQueue(e,{durable:!1})).then(function(){return Promise.resolve(r.channel.consume(e,function(e){try{var n=function(){if(e){var n=e.content.toString();console.log(n);var r=JSON.parse(n);return Promise.resolve(t(r)).then(function(){})}}();return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},{noAck:!0})).then(function(){console.log(" [*] Listening for messages in queue "+e)})})},function(e){console.warn(e)});return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},r.sendMessageToQueue=function(e,t){try{var r=this;if(!r.channel)return console.warn("RabbitMQ channel is not initialized."),Promise.resolve();var o=n(function(){return Promise.resolve(r.channel.assertQueue(e,{durable:!1})).then(function(){var n=JSON.stringify(t);r.channel.sendToQueue(e,Buffer.from(n)),console.log(" [x] Sent to queue "+e+": "+n)})},function(e){console.warn(e)});return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},t}();export{t as default};
